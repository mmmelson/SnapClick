#!/bin/bash

echo "ðŸ“¦ å¼€å§‹åˆ›å»ºå‘å¸ƒåŒ…..."
echo ""

# æ£€æŸ¥åº”ç”¨æ˜¯å¦å­˜åœ¨
if [ ! -d "SnapClick.app" ]; then
    echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° SnapClick.app"
    echo "è¯·å…ˆè¿è¡Œ ./build_app.sh æž„å»ºåº”ç”¨"
    exit 1
fi

# åˆ›å»ºåˆ†å‘ç›®å½•
DIST_DIR="dist"
VERSION="v2.0"
DIST_NAME="SnapClick-${VERSION}-arm64"

echo "ðŸ—‚ï¸  åˆ›å»ºåˆ†å‘ç›®å½•..."
rm -rf "$DIST_DIR"
mkdir -p "$DIST_DIR/$DIST_NAME"

# å¤åˆ¶åº”ç”¨
echo "ðŸ“‹ å¤åˆ¶åº”ç”¨æ–‡ä»¶..."
cp -R SnapClick.app "$DIST_DIR/$DIST_NAME/"

# åˆ›å»ºå®‰è£…è¯´æ˜Ž
echo "ðŸ“ ç”Ÿæˆå®‰è£…è¯´æ˜Ž..."
cat > "$DIST_DIR/$DIST_NAME/å®‰è£…è¯´æ˜Ž.txt" << 'EOF'
================================================================================
                          SnapClick v2.0 å®‰è£…æŒ‡å—
================================================================================

æ¬¢è¿Žä½¿ç”¨ SnapClickï¼è¿™æ˜¯ä¸€æ¬¾ä¸“ä¸º macOS è®¾è®¡çš„é«˜æ•ˆé¼ æ ‡è¿žç‚¹å™¨ã€‚

ðŸ“‹ ç³»ç»Ÿè¦æ±‚
--------------------------------------------------------------------------------
â€¢ macOS 13.0 (Ventura) æˆ–æ›´é«˜ç‰ˆæœ¬
â€¢ Apple Silicon (M1/M2/M3) èŠ¯ç‰‡
â€¢ éœ€è¦æŽˆäºˆã€Œè¾…åŠ©åŠŸèƒ½ã€æƒé™

ðŸ“¦ å®‰è£…æ­¥éª¤
--------------------------------------------------------------------------------

æ­¥éª¤ 1ï¼šç§»åŠ¨åº”ç”¨
   å°† SnapClick.app æ‹–åŠ¨åˆ°ã€Œåº”ç”¨ç¨‹åºã€æ–‡ä»¶å¤¹

æ­¥éª¤ 2ï¼šé¦–æ¬¡æ‰“å¼€ï¼ˆé‡è¦ï¼ï¼‰
   ç”±äºŽåº”ç”¨æœªç» Apple å…¬è¯ï¼Œé¦–æ¬¡æ‰“å¼€æ—¶éœ€è¦ï¼š

   æ–¹æ³• Aï¼ˆæŽ¨èï¼‰ï¼š
   1. åœ¨ Finder ä¸­æ‰¾åˆ° SnapClick.app
   2. æŒ‰ä½ Control é”®ç‚¹å‡»åº”ç”¨å›¾æ ‡
   3. é€‰æ‹©ã€Œæ‰“å¼€ã€
   4. åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ç‚¹å‡»ã€Œæ‰“å¼€ã€

   æ–¹æ³• Bï¼š
   1. å°è¯•åŒå‡»æ‰“å¼€åº”ç”¨ï¼ˆä¼šè¢« Gatekeeper é˜»æ­¢ï¼‰
   2. æ‰“å¼€ã€Œç³»ç»Ÿè®¾ç½®ã€â†’ã€Œéšç§ä¸Žå®‰å…¨æ€§ã€
   3. æ‰¾åˆ° SnapClick çš„æç¤ºï¼Œç‚¹å‡»ã€Œä»è¦æ‰“å¼€ã€

   æ–¹æ³• Cï¼ˆå‘½ä»¤è¡Œï¼‰ï¼š
   åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼š
   xattr -cr /Applications/SnapClick.app
   open /Applications/SnapClick.app

æ­¥éª¤ 3ï¼šæŽˆäºˆè¾…åŠ©åŠŸèƒ½æƒé™
   1. åº”ç”¨å¯åŠ¨åŽï¼Œç‚¹å‡»èœå•æ å›¾æ ‡
   2. å°è¯•å¯ç”¨ä»»ä¸€æ–¹æ¡ˆæ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºæŽˆæƒ
   3. å‰å¾€ã€Œç³»ç»Ÿè®¾ç½®ã€â†’ã€Œéšç§ä¸Žå®‰å…¨æ€§ã€â†’ã€Œè¾…åŠ©åŠŸèƒ½ã€
   4. æ‰¾åˆ° SnapClick å¹¶å‹¾é€‰å¯ç”¨

ðŸŽ¯ å¿«é€Ÿå¼€å§‹
--------------------------------------------------------------------------------
1. ç‚¹å‡»èœå•æ çš„ SnapClick å›¾æ ‡ï¼Œé€‰æ‹©ã€Œæ˜¾ç¤ºä¸»çª—å£ã€
2. ç‚¹å‡»ã€Œæ–°å¢žã€æŒ‰é’®åˆ›å»ºè¿žç‚¹æ–¹æ¡ˆ
3. è®¾ç½®ç‚¹å‡»æ¬¡æ•°ã€æ—¶é•¿å’Œå¿«æ·é”®
4. å¯ç”¨æ–¹æ¡ˆåŽï¼ŒæŒ‰ä¸‹å¿«æ·é”®å³å¯è§¦å‘è¿žç‚¹

âš ï¸ å¸¸è§é—®é¢˜
--------------------------------------------------------------------------------

é—®ï¼šä¸ºä»€ä¹ˆåº”ç”¨æ— æ³•æ‰“å¼€ï¼Ÿ
ç­”ï¼šè¿™æ˜¯ macOS Gatekeeper å®‰å…¨æœºåˆ¶ï¼Œè¯·æŒ‰ç…§ã€Œæ­¥éª¤ 2ã€æ“ä½œã€‚

é—®ï¼šå¿«æ·é”®ä¸å“åº”ï¼Ÿ
ç­”ï¼šè¯·ç¡®ä¿å·²æŽˆäºˆã€Œè¾…åŠ©åŠŸèƒ½ã€æƒé™ï¼Œå¹¶é‡å¯åº”ç”¨ã€‚

é—®ï¼šèƒ½åœ¨ Intel Mac ä¸Šä½¿ç”¨å—ï¼Ÿ
ç­”ï¼šå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒ Apple Siliconï¼Œè¯·ç­‰å¾… Universal ç‰ˆæœ¬ã€‚

ðŸ“š æ›´å¤šå¸®åŠ©
--------------------------------------------------------------------------------
â€¢ è¯¦ç»†æ–‡æ¡£ï¼šREADME.md
â€¢ é—®é¢˜åé¦ˆï¼šhttps://github.com/yourusername/SnapClick/issues

ç¥ä½¿ç”¨æ„‰å¿«ï¼
================================================================================
EOF

# å¤åˆ¶æ–‡æ¡£æ–‡ä»¶
echo "ðŸ“„ å¤åˆ¶æ–‡æ¡£..."
if [ -f "README.md" ]; then
    cp README.md "$DIST_DIR/$DIST_NAME/"
fi

if [ -f "ä½¿ç”¨å¿…è¯».txt" ]; then
    cp ä½¿ç”¨å¿…è¯».txt "$DIST_DIR/$DIST_NAME/"
fi

if [ -f "RELEASE_NOTES.md" ]; then
    cp RELEASE_NOTES.md "$DIST_DIR/$DIST_NAME/"
fi

# åˆ›å»º ZIP åŒ…
echo "ðŸ—œï¸  åŽ‹ç¼©å‘å¸ƒåŒ…..."
cd "$DIST_DIR"
zip -r -q "${DIST_NAME}.zip" "$DIST_NAME"
cd ..

# è®¡ç®—æ–‡ä»¶å¤§å°
APP_SIZE=$(du -sh "$DIST_DIR/$DIST_NAME/SnapClick.app" | cut -f1)
ZIP_SIZE=$(du -sh "$DIST_DIR/${DIST_NAME}.zip" | cut -f1)

# æ˜¾ç¤ºæ‘˜è¦
echo ""
echo "âœ… å‘å¸ƒåŒ…åˆ›å»ºå®Œæˆï¼"
echo ""
echo "ðŸ“Š æ–‡ä»¶ä¿¡æ¯ï¼š"
echo "   åº”ç”¨å¤§å°ï¼š$APP_SIZE"
echo "   åŽ‹ç¼©åŒ…å¤§å°ï¼š$ZIP_SIZE"
echo ""
echo "ðŸ“ å‘å¸ƒæ–‡ä»¶ï¼š"
echo "   $(pwd)/$DIST_DIR/${DIST_NAME}.zip"
echo ""
echo "ðŸ“¦ åŒ…å«å†…å®¹ï¼š"
echo "   â€¢ SnapClick.app"
echo "   â€¢ å®‰è£…è¯´æ˜Ž.txt"
echo "   â€¢ README.md (å¦‚æžœå­˜åœ¨)"
echo "   â€¢ ä½¿ç”¨å¿…è¯».txt (å¦‚æžœå­˜åœ¨)"
echo "   â€¢ RELEASE_NOTES.md (å¦‚æžœå­˜åœ¨)"
echo ""
echo "ðŸš€ ä¸‹ä¸€æ­¥ï¼š"
echo "   1. æµ‹è¯• ZIP åŒ…ä¸­çš„åº”ç”¨"
echo "   2. ä¸Šä¼ åˆ° GitHub Release"
echo "   3. æ›´æ–°å‘å¸ƒè¯´æ˜Ž"
echo ""
